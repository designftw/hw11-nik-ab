<!DOCTYPE html>
<html>
  <head>
    <script type="module" src="./chat.js"></script>
    <link rel="stylesheet" href="style.css" />

    <link href="prism.css" rel="stylesheet" />
    <script src="prism.js"></script>

    <script src="code-input.js"></script>
    <script src="plugins/indent.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.js"></script>
    <script>
      codeInput.registerTemplate(
        "syntax-highlighted",
        codeInput.templates.prism(Prism, [new codeInput.plugins.Indent()])
      );
    </script>
    <link rel="stylesheet" href="code-input.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />

    <link rel="stylesheet" href="plugins/prism-line-numbers.css" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.css"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;0,1000;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900;1,1000&family=Source+Code+Pro:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
      MathJax = {
        startup: {
          pageReady() {
            const option = MathJax.startup.document.option;
            const BaseMathItem = option.MathItem;
            option.MathItem = class FixedMathItem extends BaseMathItem {
              assistiveMml(document) {
                if (this.display !== null) super.assistiveMml(document);
              }
            };
            return MathJax.startup.defaultPageReady();
          },
        },
        options: {
          processHtmlClass: "tex2jax_process",
        },
      };
    </script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"
    ></script>
  </head>
  <body>
    <div id="app">
      <header>
        <!-- <button @click = "math()">Math</button> -->
        <h1>My Cool Chat App</h1>

        <div id="my_picture">
          <profile-picture :actor="$gf.me"></profile-picture>
        </div>
        <!-- We display names in multiple places, so we made a -->
        <!-- We display names in multiple places, so we made a -->

        <div id="my_name">
          <!-- We display names in multiple places, so we made a -->
          <!-- reusable <name></name> component. -->
          <!-- See below for the template. -->
          <name :actor="$gf.me"></name>
        </div>
        <div class="my_username">@{{myUsername}}</div>
        <button
          v-if="$gf.me"
          id="edit_profile_button"
          @click="editProfile = true"
        >
          Edit Profile
        </button>
        <div>
          <button  class="button_background" @click="$gf.toggleLogIn">
            <!-- If we have a user ID, we're logged in so show "Log Out" -->
            <!-- Otherwise, show "Log In" -->
            {{ $gf.me? 'Log Out' : 'Log In' }}
          </button>
        </div>
      </header>
      <!-- If we're not logged in, hide everything except the login button -->
      <template v-if="$gf.me">
        <!------------------------->
        <!------------------------->
        <!-- Edit Profile Screen -->
        <!------------------------->
        <!------------------------->
        <!------------------------->

        <div
          id="edit_profile_screen"
          v-if="editProfile"
          @click="editProfile = false"
        >
          <div
            id="edit_profile_modal"
            @click="(event)=>event.stopPropagation()"
          >
            <button
              class="button_background"
              id="close_button"
              @click="editProfile = false"
            >
              Close X
            </button>
            <div id="my_picture">
              <profile-picture
                :actor="$gf.me"
                :editable="true"
              ></profile-picture>
            </div>
            <div class="row">
              <label>Name: </label>
              <!-- We display names in multiple places, so we made a -->
              <!-- reusable <name></name> component. -->
              <!-- See below for the template. -->
              <name id="my_name" :actor="$gf.me" :editable="true"></name>
            </div>
            <div class="column usernameRequest">
              <div class="row">
                <label>Username: </label>
                <div class="my_username">@{{myUsername}}</div>
                <button @click="editUsername = !editUsername">
                  {{!editUsername ? 'Edit' : 'X'}}
                </button>
              </div>
              <form
                class="row"
                v-if="editUsername"
                @submit.prevent="setUsername"
              >
                <input
                  v-model="preferredUsername"
                  style="height:100%;"
                  placeholder="Choose a username..."
                />
                <input class ="button_background" type="submit" value="Set Username" />
              </form>
              {{ usernameResult }}
            </div>
          </div>
        </div>
        <!------------------------->
        <!------------------------->
        <!------------------------->
        <!------------------------->
        <!------------------------->

        <!------------------------->
        <!------------------------->
        <!---Edit Latex Screen----->
        <!------------------------->
        <!------------------------->
        <div id="edit_latex_screen" v-if="editLatex" @click="editLatex = false">
          <div id="edit_latex_modal" @click="(event)=>event.stopPropagation()">
            <div id="latex_input">
              <textarea
                id="latex_textarea"
                v-model="latexInput"
                v-focus
              ></textarea>
            </div>

            <div id="latex_preview">
              <pre class="tex2jax_process" id="latex_preview_content"></pre>
              <div id="latex_tip">
                <p>
                  <em>Pro tip:</em> Write LaTeX directly in your messages by
                  typing one of the following:
                </p>
                <div>
                  <code>\( <em>Your LaTeX Here...</em>\)</code> for
                  <div class="definition">
                    <div>
                      Inline mode is for math that is included within a line or
                      paragraph of text
                    </div>
                    inline LaTeX
                  </div>
                </div>
                <div>
                  <code>$$ <em>Your LaTeX Here...</em>$$</code> or
                </div>
                <div>
                  <code>\[ <em>Your LaTeX Here...</em>\]</code> for
                  <div class="definition">
                    <div>
                      Display mode is for math that is set apart from the main
                      text.
                    </div>
                    display LaTeX
                  </div>
                </div>
              </div>
              <div id="button_container">
                <button
                  class="button_background"
                  id="cancel_button"
                  @click="cancelLatex()"
                >
                  Cancel
                </button>
                <button
                  class="button_background"
                  id="done_button"
                  @click="doneLatex()"
                >
                  Done
                </button>
              </div>
            </div>
          </div>
        </div>

        <div id="edit_code_screen" v-if="editCode" @click="cancelCode()">
          <div id="edit_code_modal" @click="(event)=>event.stopPropagation()">
            <div id="code_input">
              <code-input
                id="code_textarea"
                lang="none"
                class="line-numbers"
                placeholder="type code here..."
              ></code-input>
            </div>
            <div id="code_settings">
              <div id="language_selector" class="column">
                <label for="languageSelect">Select Language: </label>
                <select id="languageSelect" v-model="codeLanguage">
                  <option value="html">HTML</option>
                  <option value="css">CSS</option>
                  <option value="clike">C-like</option>
                  <option value="javascript">JavaScript</option>
                  <option value="abap">ABAP</option>
                  <option value="abnf">ABNF</option>
                  <option value="actionscript">ActionScript</option>
                  <option value="ada">Ada</option>
                  <option value="agda">Agda</option>
                  <option value="al">AL</option>
                  <option value="antlr4">ANTLR4</option>
                  <option value="apacheconf">Configuration</option>
                  <option value="apex">Apex</option>
                  <option value="apl">APL</option>
                  <option value="applescript">AppleScript</option>
                  <option value="aql">AQL</option>
                  <option value="arduino">Arduino</option>
                  <option value="arff">ARFF</option>
                  <option value="armasm">Assembly</option>
                  <option value="arturo">Arturo</option>
                  <option value="asciidoc">AsciiDoc</option>
                  <option value="aspnet">(C#)</option>
                  <option value="asm6502">Assembly</option>
                  <option value="asmatmel">Assembly</option>
                  <option value="autohotkey">AutoHotkey</option>
                  <option value="autoit">AutoIt</option>
                  <option value="avisynth">AviSynth</option>
                  <option value="avro-idl">IDL</option>
                  <option value="awk">AWK</option>
                  <option value="bash">Bash</option>
                  <option value="basic">BASIC</option>
                  <option value="batch">Batch</option>
                  <option value="bbcode">BBcode</option>
                  <option value="bbj">BBj</option>
                  <option value="bicep">Bicep</option>
                  <option value="birb">Birb</option>
                  <option value="bison">Bison</option>
                  <option value="bnf">BNF</option>
                  <option value="bqn">BQN</option>
                  <option value="brainfuck">Brainfuck</option>
                  <option value="brightscript">BrightScript</option>
                  <option value="bro">Bro</option>
                  <option value="bsl">(1C:Enterprise)</option>
                  <option value="c">C</option>
                  <option value="csharp">C#</option>
                  <option value="cpp">C++</option>
                  <option value="cfscript">CFScript</option>
                  <option value="chaiscript">ChaiScript</option>
                  <option value="cil">CIL</option>
                  <option value="cilkc">Cilk/C</option>
                  <option value="cilkcpp">Cilk/C++</option>
                  <option value="clojure">Clojure</option>
                  <option value="cmake">CMake</option>
                  <option value="cobol">COBOL</option>
                  <option value="coffeescript">CoffeeScript</option>
                  <option value="concurnas">Concurnas</option>
                  <option value="csp">Content-Security-Policy</option>
                  <option value="cooklang">Cooklang</option>
                  <option value="coq">Coq</option>
                  <option value="crystal">Crystal</option>
                  <option value="css-extras">Extras</option>
                  <option value="csv">CSV</option>
                  <option value="cue">CUE</option>
                  <option value="cypher">Cypher</option>
                  <option value="d">D</option>
                  <option value="dart">Dart</option>
                  <option value="dataweave">DataWeave</option>
                  <option value="dax">DAX</option>
                  <option value="dhall">Dhall</option>
                  <option value="diff">Diff</option>
                  <option value="django">Django/Jinja2</option>
                  <option value="dns-zone-file">file</option>
                  <option value="docker">Docker</option>
                  <option value="dot">(Graphviz)</option>
                  <option value="ebnf">EBNF</option>
                  <option value="editorconfig">EditorConfig</option>
                  <option value="eiffel">Eiffel</option>
                  <option value="ejs">EJS</option>
                  <option value="elixir">Elixir</option>
                  <option value="elm">Elm</option>
                  <option value="etlua">templating</option>
                  <option value="erb">ERB</option>
                  <option value="erlang">Erlang</option>
                  <option value="excel-formula">Formula</option>
                  <option value="fsharp">F#</option>
                  <option value="factor">Factor</option>
                  <option value="false">False</option>
                  <option value="firestore-security-rules">rules</option>
                  <option value="flow">Flow</option>
                  <option value="fortran">Fortran</option>
                  <option value="ftl">Language</option>
                  <option value="gml">Language</option>
                  <option value="gap">(CAS)</option>
                  <option value="gcode">G-code</option>
                  <option value="gdscript">GDScript</option>
                  <option value="gedcom">GEDCOM</option>
                  <option value="gettext">gettext</option>
                  <option value="gherkin">Gherkin</option>
                  <option value="git">Git</option>
                  <option value="glsl">GLSL</option>
                  <option value="gn">GN</option>
                  <option value="linker-script">Script</option>
                  <option value="go">Go</option>
                  <option value="go-module">module</option>
                  <option value="gradle">Gradle</option>
                  <option value="graphql">GraphQL</option>
                  <option value="groovy">Groovy</option>
                  <option value="haml">Haml</option>
                  <option value="handlebars">Handlebars</option>
                  <option value="haskell">Haskell</option>
                  <option value="haxe">Haxe</option>
                  <option value="hcl">HCL</option>
                  <option value="hlsl">HLSL</option>
                  <option value="hoon">Hoon</option>
                  <option value="http">HTTP</option>
                  <option value="hpkp">Public-Key-Pins</option>
                  <option value="hsts">Strict-Transport-Security</option>
                  <option value="ichigojam">IchigoJam</option>
                  <option value="icon">Icon</option>
                  <option value="icu-message-format">Format</option>
                  <option value="idris">Idris</option>
                  <option value="ignore">.ignore</option>
                  <option value="inform7">7</option>
                  <option value="ini">Ini</option>
                  <option value="io">Io</option>
                  <option value="j">J</option>
                  <option value="java">Java</option>
                  <option value="javadoc">JavaDoc</option>
                  <option value="javadoclike">JavaDoc-like</option>
                  <option value="javastacktrace">trace</option>
                  <option value="jexl">Jexl</option>
                  <option value="jolie">Jolie</option>
                  <option value="jq">JQ</option>
                  <option value="jsdoc">JSDoc</option>
                  <option value="js-extras">Extras</option>
                  <option value="json">JSON</option>
                  <option value="json5">JSON5</option>
                  <option value="jsonp">JSONP</option>
                  <option value="jsstacktrace">trace</option>
                  <option value="js-templates">Templates</option>
                  <option value="julia">Julia</option>
                  <option value="keepalived">Configure</option>
                  <option value="keyman">Keyman</option>
                  <option value="kotlin">Kotlin</option>
                  <option value="kumir">(КуМир)</option>
                  <option value="kusto">Kusto</option>
                  <option value="latex">LaTeX</option>
                  <option value="latte">Latte</option>
                  <option value="less">Less</option>
                  <option value="lilypond">LilyPond</option>
                  <option value="liquid">Liquid</option>
                  <option value="lisp">Lisp</option>
                  <option value="livescript">LiveScript</option>
                  <option value="llvm">IR</option>
                  <option value="log">file</option>
                  <option value="lolcode">LOLCODE</option>
                  <option value="lua">Lua</option>
                  <option value="magma">(CAS)</option>
                  <option value="makefile">Makefile</option>
                  <option value="markdown">Markdown</option>
                  <option value="markup-templating">templating</option>
                  <option value="mata">Mata</option>
                  <option value="matlab">MATLAB</option>
                  <option value="maxscript">MAXScript</option>
                  <option value="mel">MEL</option>
                  <option value="mermaid">Mermaid</option>
                  <option value="metafont">METAFONT</option>
                  <option value="mizar">Mizar</option>
                  <option value="mongodb">MongoDB</option>
                  <option value="monkey">Monkey</option>
                  <option value="moonscript">MoonScript</option>
                  <option value="n1ql">N1QL</option>
                  <option value="n4js">N4JS</option>
                  <option value="nand2tetris-hdl">HDL</option>
                  <option value="naniscript">Script</option>
                  <option value="nasm">NASM</option>
                  <option value="neon">NEON</option>
                  <option value="nevod">Nevod</option>
                  <option value="nginx">nginx</option>
                  <option value="nim">Nim</option>
                  <option value="nix">Nix</option>
                  <option value="nsis">NSIS</option>
                  <option value="objectivec">Objective-C</option>
                  <option value="ocaml">OCaml</option>
                  <option value="odin">Odin</option>
                  <option value="opencl">OpenCL</option>
                  <option value="openqasm">OpenQasm</option>
                  <option value="oz">Oz</option>
                  <option value="parigp">PARI/GP</option>
                  <option value="parser">Parser</option>
                  <option value="pascal">Pascal</option>
                  <option value="pascaligo">Pascaligo</option>
                  <option value="psl">Language</option>
                  <option value="pcaxis">PC-Axis</option>
                  <option value="peoplecode">PeopleCode</option>
                  <option value="perl">Perl</option>
                  <option value="php">PHP</option>
                  <option value="phpdoc">PHPDoc</option>
                  <option value="php-extras">Extras</option>
                  <option value="plant-uml">PlantUML</option>
                  <option value="plsql">PL/SQL</option>
                  <option value="powerquery">PowerQuery</option>
                  <option value="powershell">PowerShell</option>
                  <option value="processing">Processing</option>
                  <option value="prolog">Prolog</option>
                  <option value="promql">PromQL</option>
                  <option value="properties">.properties</option>
                  <option value="protobuf">Buffers</option>
                  <option value="pug">Pug</option>
                  <option value="puppet">Puppet</option>
                  <option value="pure">Pure</option>
                  <option value="purebasic">PureBasic</option>
                  <option value="purescript">PureScript</option>
                  <option value="python">Python</option>
                  <option value="qsharp">Q#</option>
                  <option value="q">database)</option>
                  <option value="qml">QML</option>
                  <option value="qore">Qore</option>
                  <option value="r">R</option>
                  <option value="racket">Racket</option>
                  <option value="cshtml">C#</option>
                  <option value="jsx">JSX</option>
                  <option value="tsx">TSX</option>
                  <option value="reason">Reason</option>
                  <option value="regex">Regex</option>
                  <option value="rego">Rego</option>
                  <option value="renpy">Ren'py</option>
                  <option value="rescript">ReScript</option>
                  <option value="rest">(reStructuredText)</option>
                  <option value="rip">Rip</option>
                  <option value="roboconf">Roboconf</option>
                  <option value="robotframework">Framework</option>
                  <option value="ruby">Ruby</option>
                  <option value="rust">Rust</option>
                  <option value="sas">SAS</option>
                  <option value="sass">(Sass)</option>
                  <option value="scss">(SCSS)</option>
                  <option value="scala">Scala</option>
                  <option value="scheme">Scheme</option>
                  <option value="shell-session">session</option>
                  <option value="smali">Smali</option>
                  <option value="smalltalk">Smalltalk</option>
                  <option value="smarty">Smarty</option>
                  <option value="sml">SML</option>
                  <option value="solidity">(Ethereum)</option>
                  <option value="solution-file">file</option>
                  <option value="soy">Template)</option>
                  <option value="sparql">SPARQL</option>
                  <option value="splunk-spl">SPL</option>
                  <option value="sqf">3)</option>
                  <option value="sql">SQL</option>
                  <option value="squirrel">Squirrel</option>
                  <option value="stan">Stan</option>
                  <option value="stata">Ado</option>
                  <option value="iecst">61131-3)</option>
                  <option value="stylus">Stylus</option>
                  <option value="supercollider">SuperCollider</option>
                  <option value="swift">Swift</option>
                  <option value="systemd">file</option>
                  <option value="t4-templating">templating</option>
                  <option value="t4-cs">(C#)</option>
                  <option value="t4-vb">(VB)</option>
                  <option value="tap">TAP</option>
                  <option value="tcl">Tcl</option>
                  <option value="tt2">2</option>
                  <option value="textile">Textile</option>
                  <option value="toml">TOML</option>
                  <option value="tremor">Tremor</option>
                  <option value="turtle">Turtle</option>
                  <option value="twig">Twig</option>
                  <option value="typescript">TypeScript</option>
                  <option value="typoscript">TypoScript</option>
                  <option value="unrealscript">UnrealScript</option>
                  <option value="uorazor">Script</option>
                  <option value="uri">URI</option>
                  <option value="v">V</option>
                  <option value="vala">Vala</option>
                  <option value="vbnet">VB.Net</option>
                  <option value="velocity">Velocity</option>
                  <option value="verilog">Verilog</option>
                  <option value="vhdl">VHDL</option>
                  <option value="vim">vim</option>
                  <option value="visual-basic">Basic</option>
                  <option value="warpscript">WarpScript</option>
                  <option value="wasm">WebAssembly</option>
                  <option value="web-idl">IDL</option>
                  <option value="wgsl">WGSL</option>
                  <option value="wiki">markup</option>
                  <option value="wolfram">language</option>
                  <option value="wren">Wren</option>
                  <option value="xeora">Xeora</option>
                  <option value="xml-doc">(.net)</option>
                  <option value="xojo">(REALbasic)</option>
                  <option value="xquery">XQuery</option>
                  <option value="yaml">YAML</option>
                  <option value="yang">YANG</option>
                  <option value="zig">Zig</option>
                </select>
              </div>
              <div id="button_container">
                <button
                  class="button_background"
                  id="cancel_button"
                  @click="cancelCode()"
                >
                  Cancel
                </button>
                <button
                  class="button_background"
                  id="done_button"
                  @click="doneCode()"
                >
                  {{editingCode ? 'Save' : 'Send'}}
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- End Problem 1 Solution -->
        <div id="below_header">
          <div id="sidebar">
            <div id="chat_format_input">
              <div class="input_label">Change chat format:</div>
              <div>
                <input
                  type="radio"
                  id="channel"
                  :value="false"
                  v-model="privateMessaging"
                />
                <label for="channel">Channel-based public chat</label>
              </div>
              <div>
                <input
                  type="radio"
                  id="pm"
                  :value="true"
                  v-model="privateMessaging"
                />
                <label for="pm">Private Messaging</label>
              </div>
            </div>

            <div id="channel_input" v-if="!privateMessaging">
              <label class="input_label" for="channel">
                Change the channel:
              </label>
              <input id="channel" v-model="channel" @input="maxMessages = 10" />
            </div>
            <!-- Begin problem 2 solution -->
            <div id="private_input_container" v-else>
              <form @submit.prevent="chatWithUser">
                <label class="input_label" for="recipient">
                  Type the username of who you'd like to chat with:
                </label>
                <div id="private_input">
                  <input id="recipient" v-model="recipientUsernameSearch" />
                  <input class = "button_background" id="private_submit" type="submit" value="Search" />
                </div>
              </form>
              <span v-if="recipient">
                Chatting with {{ recipientUsername }}
              </span>
              <span v-else-if = "searchFailed">
                Username {{ recipientUsername }} does not exist!
              </span>
            </div>
          </div>

          <div id="rest">
            <div v-if = "privateMessaging && recipient" id = "recipient_header" class = "row">
              <div class="recipient_picture">
                <profile-picture :actor="recipient"></profile-picture>
              </div>
              <div class="message_name">
                <name :actor="recipient"></name>
              </div>
              <!-- <div>From Actor ID: {{ message.actor }}</div> -->
              <div class="message_username">
                @{{recipientUsername}}
              </div>
            </div>
            <div v-if = "privateMessaging && !recipient" id ="no_messages" class ="message_list">
              Search for username to start chatting with someone!
            </div>
            <div
              class="message_list"
              id="no_messages"
              v-else-if="messages.length === 0"
            >
              No messages here. Type message to start a conversation!
            </div>
            <ul class="message_list" @scroll="onscroll" v-else>
              <transition-group>
                <!-- List all the messages -->
                <li v-for="message of messages" :key="message.id">
                  <!-- Display and edit form if we're editing a message -->

                  <!-- Otherwise, display a bunch of properties from the message -->
                  <ul class="message_container">
                    <div class="message_picture">
                      <profile-picture :actor="message.actor"></profile-picture>

                      <li class="message_like">
                        <like :messageid="message.id"></like>
                      </li>
                    </div>

                    <div class="message_content_container">
                      <li class="message_user">
                        <div class="message_name">
                          <name :actor="message.actor"></name>
                        </div>
                        <!-- <div>From Actor ID: {{ message.actor }}</div> -->
                        <div class="message_username">
                          @{{ $actorsToUsernames.value[message.actor] }}
                        </div>

                        <div class="date_container">
                          <span class="message_date"
                            >{{ getDate(message.published) }}</span
                          >
                          <span
                            class="message_edit_date"
                            v-if="message.updated !== message.published"
                          >
                            Edited: {{ getDate(message.updated) }}
                          </span>
                        </div>
                      </li>
                      <li
                        class="message_edit_content"
                        v-if="editID==message.id"
                      >
                        <form
                          class="row"
                          @submit.prevent="saveEditMessage(message)"
                        >
                          <input
                            class="edit_input"
                            v-model="editText"
                            autocomplete="off"
                          />
                          <input
                            class="button_background"
                            type="submit"
                            value="Save"
                          />
                        </form>
                      </li>

                      <li
                        class="message_content"
                        v-else-if="message.content.length>0"
                      >
                        <pre class="tex2jax_process" v-if = "message.type == 'Note'">{{ message.content }}</pre>
                        <pre data-src="plugins/toolbar/prism-toolbar.js" :class = "`line-numbers  code_message language-${message.language}`"  v-else><code>{{message.content}}</code></pre>
                      </li>
                      <!-- 
                  <template v-if="privateMessaging">
                    <li>To Name: <name :actor="message.bto[0]"></name></li>
                    <li>To Actor ID: {{ message.bto[0] }}</li>
                    <li>
                      To Username: {{ actorsToUsernames[message.bto[0]] }}
                    </li>
                  </template> -->

                      <!-- <li>
               This is a unique identifier that can be used to "link" to messages
                ID: {{ message.id }}
              </li> -->

                      <li
                        class="message_attachment"
                        v-if="message.attachment && message.attachment.magnet in imageDownloads"
                      >
                        <span
                          v-if="imageDownloads[message.attachment.magnet]=='downloading'"
                        >
                          Image is downloading...
                        </span>
                        <span
                          v-else-if="imageDownloads[message.attachment.magnet]=='error'"
                        >
                          Image could not be downloaded!
                        </span>
                        <img
                          v-else
                          :src="imageDownloads[message.attachment.magnet]"
                        />
                      </li>
                      <li class="message_reads">
                        <read-receipts
                          :actors-to-usernames="actorsToUsernames"
                          :messageid="message.id"
                          :private="privateMessaging"
                        ></read-receipts>
                      </li>
                      <li class="message_replies">
                        <replies
                          :messageid="message.id"
                        ></replies>
                      </li>
                    </div>

                    <!-- Only add these controls if the message is ours -->
                    <!-- You can't edit or delete other people's messages -->
                    <template v-if="message.actor==$gf.me">
                      <li>
                        <div class="confirmation_container">
                          <transition>
                            <div
                              v-if="deleteId === message.id"
                              class="delete_confirmation"
                              :key="'d'+message.id"
                            >
                              Are you sure you want to delete this message?
                              <button
                                class="button_background yes_button"
                                @click="removeMessage(message)"
                              >
                                Yes
                              </button>
                              <button class="button_background no_button" @click="deleteId = ''">
                                No
                              </button>
                            </div>
                          </transition>
                        </div>
                        <transition>
                          <button
                            class="delete_button button_background"
                            @click="deleteButton(message)"
                          >
                            <img src="delete.svg" />
                          </button>
                        </transition>
                      </li>
                      <li>
                        <button
                          @click="startEditMessage(message)"
                          class="edit_button button_background"
                        >
                          <img src="edit.svg" v-if ="editID !== message.id" />
                          <img src="cancel.svg" v-else/>
                        </button>
                      </li>
                    </template>
                  </ul>
                </li>
              </transition-group>
            </ul>
            <div id="mathjax_preview" :class="{mathjax: mathJaxDetected}">
              <div>LaTeX detected! Preview:</div>
              <pre class="tex2jax_process" id="mathjax_preview_content">
{{messageText}}</pre
              >
            </div>
            <div v-if = "!privateMessaging || recipient" id = "input_row" class="row">
              <form
                id="send_message"
                @submit.prevent="sendMessage"
                @keypress.enter.prevent="sendMessage"
                autocomplete="off"
              >
                <input
                  id="text_input"
                  v-model="messageText"
                  placeholder="Type a message..."
                />
                <div id="insert_container">
                  <button
                    id="insert_button"
                    @click.prevent="insertVisible = !insertVisible"
                  >
                    Insert
                  </button>
                  <transition name="insert">
                    <ul id="insert_list" v-if="insertVisible">
                      <li>
                        <button @click.prevent="startCodeEdit()">
                          Insert Code
                        </button>
                      </li>
                      <li>
                        <button @click.prevent="startLatexEdit()">
                          Insert LaTeX
                        </button>
                      </li>
                    </ul>
                  </transition>
                </div>
                <input
                  type="file"
                  id="file"
                  accept="image/*"
                  @change="onImageAttachment"
                />

                <label for="file">
                  <div class="row" v-if="file" id="file_name">
                    <div id = >{{file.name.length < 15 ? file.name :
                    (file.name.slice(0,12) + '...')}}
                  </div>
                  <button id="cancel_file" @click.prevent="file = null">
                    <strong>X</strong>
                  </button>
                  </div>

                  <p v-else>Upload Image</p>
                </label>

                <input class="button_background" type="submit" value="Send" />
              </form>
            </div>
          </div>
        </div>
      </template>
      <template v-else>
        <div id="not_logged_in">
          <div id="log_in_screen">
            <button class = "button_background" @click="$gf.toggleLogIn">
              <!-- If we have a user ID, we're logged in so show "Log Out" -->
              <!-- Otherwise, show "Log In" -->
              {{ $gf.me? 'Log Out' : 'Log In' }}
            </button>
            <p>to start chatting!</p>
          </div>
        </div>
      </template>
    </div>

    <template id="name">
      <span v-if="!editing" class="name">
        <!-- If we're not editing the name-->
        <!-- Display the profile's name, if it exists -->
        <!-- or anonymous if it doesn't -->
        {{ profile? profile.name : 'Anonymous' }}

        <!-- Also if the name is "editable" add an edit button -->
        <button v-if="editable" @click="editName">Edit</button>
      </span>

      <!-- If we're in the editing state, create something to edit the name-->
      <form v-else @submit.prevent="saveName">
        <input v-model="editText" />
        <input class ="button_background" type="submit" value="Save Name" />
      </form>
    </template>

    <template id="like">
      <div class="like_container">
        <button
          class="like_button"
          v-if="myLikes.length === 0"
          @click="toggleLike"
          :key="'L'+messageid"
        >
          <img src="heart.svg" />
        </button>
        <transition>
          <button
            class="like_button"
            v-if="myLikes.length !== 0"
            @click="toggleLike"
            :key="'U'+messageid"
          >
            <img src="heart_filled.svg" />
          </button>
        </transition>
        <div class="like_count">{{ numLikes }}</div>
      </div>
    </template>

    <template id="read_receipts">
      <div class="read_container" v-if="!private">
        <div class="no_one_seen" v-if="readActors.length === 0">
          Seen by no one
        </div>
        <div class="read_list" v-else>
          <ul>
            <li v-for="(actor, i) of readActors">
              <div class="read_user">
                <name :actor="actor" :editable="false"></name>
                <div class="read_username">@{{readUsernames[i]}}</div>
              </div>
            </li>
          </ul>
          <div class="number_seen">
            Seen by {{readActors.length}} {{readActors.length === 1 ? 'person' :
            'people'}}
          </div>
        </div>
      </div>
      <div class="read_container" v-else>
        <div class="no_one_seen" v-if="readActors.length === 0">Not seen</div>

        <div class="no_one_seen" v-else>&check; Seen!</div>
      </div>
    </template>
    <template id="replies">
      <div :id="'reply'+messageid">
        <button @click="toggleReplies()">
          {{replies.length === 0 ? (viewReplies ? 'Cancel' : `Reply`) :
          (viewReplies ? 'Hide Replies' : `View ${replies.length} Replies`)}}
        </button>
        <transition>
          <ul class="reply_list" v-if="viewReplies">
            <li v-for="reply in replies">
              <div class="reply_user">
                <div class="reply_name">
                  <name :actor="reply.actor"></name>
                </div>
                <!-- <div>From Actor ID: {{ reply.actor }}</div> -->
                <div class="reply_username">
                  @{{ actorsToUsernames[reply.actor] }}
                </div>
              </div>
              <div class="reply_content">
                <pre class="tex2jax_process">{{ reply.content }}</pre>
              </div>
            </li>
          </ul>
        </transition>
        <div
          v-if="viewReplies"
          class="reply_mathjax_preview"
          :class="{mathjax: mathJaxDetected}"
        >
          <div>LaTeX detected! Preview:</div>
          <pre class="tex2jax_process reply_mathjax_preview_content">
{{replyText}}</pre
          >
        </div>
        <form
          class="row reply_message"
          v-if="viewReplies"
          @submit.prevent="sendReply"
        >
          <input
            class="reply_input"
            v-model="replyText"
            placeholder="Type a reply..."
          />
          <input class="button_background" type="submit" value="Send" />
        </form>
      </div>
    </template>

    <template id="profile_picture">
      <span class="profile_outside_container column">
        <div class="profile_picture_container row">
          <!-- If we're not editing the name-->
          <!-- Display the profile's name, if it exists -->
          <!-- or anonymous if it doesn't -->
          <div class="profile_picture error" v-if="imageUrl == 'error'">
            <img class="profile_picture" src="no_image.png" />
          </div>
          <img
            v-else-if="imageUrl.length > 0"
            :src="imageUrl"
            class="profile_picture"
          />
          <div class="profile_picture loading" v-else-if="profile"></div>
          <img v-else class="profile_picture" src="no_image.png" />
        </div>

        <form
          v-if="editable"
          class="profile_picture_form column"
          @submit.prevent="saveImage"
        >
          <input
            id="file2"
            type="file"
            accept="image/*"
            @change="changeImage"
          />
          <label for="file2">Choose an image</label>
          <div  class="row">
            <div>{{file.name ? file.name : 'No file chosen'}}</div>
            <input class ="button_background" v-if="file.name" type="submit" value="Save Picture!" />
          </div>
        </form>
      </span>
      <!-- If we're in the editing state, create something to edit the name-->
    </template>
  </body>
</html>
